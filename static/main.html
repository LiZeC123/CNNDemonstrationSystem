<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>卷积神经网络演示系统</title>
    <link rel="stylesheet" href="css/main.css" type="text/css"/>
    <link href="ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css"/>

    <script src="js/jquery-1.7.2.min.js"></script>
    <script src="js/paper-full.min.js"></script>
    <script src="ligerUI/js/ligerui.min.js"></script>
    <script src="ligerUI/js/plugins/ligerDialog.js" type="text/javascript"></script>

    <script src="js/dataTools.js"></script>
    <script src="js/headButton.js"></script>
    <script src="js/paper/commonTools.js" type="text/paperscript" canvas="drawCanvas"></script>
    <script src="js/paper/mouseBrush.js" type="text/paperscript" canvas="drawCanvas"></script>

    <script src="js/paper/mainMain.js" type="text/paperscript" canvas="mainCanvas"></script>
    <script src="js/paper/detailCanvas.js" type="text/paperscript" canvas="detailCanvas"></script>

    <script src="js/paper/conv1Conv.js" type="text/paperscript" canvas="conv1Canvas"></script>
    <script src="js/paper/conv1ReLU.js" type="text/paperscript" canvas="reLU1Canvas"></script>
    <script src="js/paper/conv1Pool.js" type="text/paperscript" canvas="pool1Canvas"></script>

    <script src="js/paper/mainConv2Wb.js" type="text/paperscript" canvas="conv2WbCanvas"></script>
    <script src="js/paper/conv2Conv.js" type="text/paperscript" canvas="conv2Canvas"></script>
    <script src="js/paper/conv2ReLU.js" type="text/paperscript" canvas="reLU2Canvas"></script>
    <script src="js/paper/conv2Pool.js" type="text/paperscript" canvas="pool2Canvas"></script>

    <script src="js/paper/mainFc.js" type="text/paperscript" canvas="fullCanvas"></script>

    <script type="text/javascript">
        var shrink = true;
        $(function () {
            $("#pool1Canvas").click(function () {
                if (shrink) {
                    $("#conv1Canvas").hide("slow");
                    $("#reLU1Canvas").hide("slow");
                    $("#conv2WbCanvas").hide();
                    $("#conv2Canvas").hide();
                    $("#reLU2Canvas").hide();
                    $("#mainCanvas").show();
                    $("#pool2Canvas").show();
                    $("#fullCanvas").show();
                } else {
                    $("#fullCanvas").hide();
                    $("#pool2Canvas").hide("slow", function () {
                        $("#mainCanvas").show();
                        $("#conv1Canvas").show("slow");
                        $("#reLU1Canvas").show("slow");
                    });
                }
                shrink = !shrink;
            });
            $("#pool2Canvas").click(function () {
                if (shrink) {
                    $("#conv2WbCanvas").hide("slow");
                    $("#conv2Canvas").hide("slow");
                    $("#reLU2Canvas").hide("slow", function () {
                        $("#mainCanvas").show("slow");
                        $("#pool1Canvas").show("slow");
                        $("#fullCanvas").show("slow");
                    });
                } else {
                    $("#fullCanvas").hide();
                    $("#mainCanvas").hide("slow", function () {
                        $("#conv2WbCanvas").show("slow");
                        $("#conv2Canvas").show("slow");
                        $("#reLU2Canvas").show("slow");
                    });
                }
                shrink = !shrink;
            });
            $("#fullCanvas").click(function () {
                if (shrink) {
                    $("#mainCanvas").show("slow");
                    $("#pool1Canvas").show("slow");
                } else {
                    $("#mainCanvas").hide("slow");
                    $("#pool1Canvas").hide("slow");
                }
                shrink = !shrink;
            });

            $("#mainCanvas").mousemove(function (e) {
                const xx = e.originalEvent.x || e.originalEvent.layerX || 0;
                const yy = e.originalEvent.y || e.originalEvent.layerY || 0;
                const positionX = e.pageX - $(this).offset().left; //获取当前鼠标相对img的X坐标
                const positionY = e.pageY - $(this).offset().top; //获取当前鼠标相对img的Y坐标
                const detail = $("#detailCanvas");
                const pos = mainMainToIdx(positionX, positionY);
                if (pos.row >= 0 && pos.col >= 0 && pos.row < 28 && pos.col < 28) {
                    detail.show();
                    detail.css({"left": xx + 20, "top": yy - 140});
                    console.log(pos);
                    drawDetail("输入层", window.calcData.inputImage[pos.row * 28 + pos.col]);
                } else {
                    detail.hide();
                }

                // console.log(positionX + '   ' + positionY);
                // console.log(mainMainToIdx(positionX,positionY));
            });

            /*
            $("#fullCanvas").mousemove(function (e) {
                var positionX = e.pageX - $(this).offset().left; //获取当前鼠标相对img的X坐标
                var positionY = e.pageY - $(this).offset().top; //获取当前鼠标相对img的Y坐标
                console.log(positionX + '   ' + positionY);
            });

            $("#reLU2Canvas").mousemove(function (e) {
                var positionX = e.pageX - $(this).offset().left; //获取当前鼠标相对img的X坐标
                var positionY = e.pageY - $(this).offset().top; //获取当前鼠标相对img的Y坐标
                console.log(positionX + '   ' + positionY);
            });
            */

            /*
            $("body").mousemove(function (e) {
                // 获得针对浏览器窗口的坐标
                const xx = e.originalEvent.x || e.originalEvent.layerX || 0;
                const yy = e.originalEvent.y || e.originalEvent.layerY || 0;
                const detail = $("#detailCanvas");
                //console.log(xx + '   ' + yy);

                // 获得相对页面的坐标
                if (e.pageY > 150) {
                    detail.show();
                    if (xx < 620) {
                        detail.css({"left": xx + 20, "top": yy - 140});
                    } else {
                        detail.css({"left": xx - 600 - 20, "top": yy - 140});
                    }
                } else {
                    detail.hide();
                }
            });
             */

            $("#btnOpen").click(function () {
                window.dialog = $.ligerDialog.open({target: $("#mainHeadDiv"), width: 249, title: "请输入手写数字"});
            });
        });
    </script>
</head>

<body>
<canvas id="detailCanvas"></canvas>
<span style="display: inline-block;font-size: 20px;color: black;padding-top: 6px">卷积神经网络演示系统</span>

<button id="btnOpen" style="width:80px;height: 26px;background-color:pink;">Open</button>

<div>
    识别结果是
    <div id="numberResult"></div>
</div>

<div class="mainDiv">
    <canvas id="mainCanvas"></canvas>
    <canvas id="conv1Canvas" class="showCanvas" style="width: 356px;"></canvas>
    <canvas id="reLU1Canvas" class="showCanvas" style="width: 356px;"></canvas>
    <canvas id="pool1Canvas" class="showCanvas" style="width: 282px;"></canvas>
    <canvas id="conv2WbCanvas" class="showCanvas" style="width: 210px"></canvas>
    <canvas id="conv2Canvas" class="showCanvas" style="width: 360px;"></canvas>
    <canvas id="reLU2Canvas" class="showCanvas" style="width: 360px;"></canvas>
    <canvas id="pool2Canvas" class="showCanvas" style="width: 146px;"></canvas>
    <canvas id="fullCanvas" class="showCanvas" style="width: 575px;"></canvas>
</div>

</body>

<div id="mainHeadDiv" style="display: none">
    <canvas id="drawCanvas" width="224" height="224" style="background-color: #7c7c7c;"></canvas>
    <br/>
    <button id="btnExport" style="width:110px;background-color:pink;"
            onclick="drawExport(window.location.href); ">导出
    </button>
    <button id="btnClear" style="width:110px;background-color:yellow; " onclick="drawClean();">清除</button>
    <button id="btnNew" style="width:80px;background-color:blue;" onclick="drawNew();">切换</button>
</div>

</html>

