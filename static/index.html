<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        .showCanvas {
            height: 1344px;
            background-color: #7c7c7c;
            position: relative;
            margin-left: -5px;
        }

        #mainCanvas {
            width: 356px;
            height: 1344px;

            background-color: #7c7c7c;
            position: relative;
            top: 0;
        }

        .line {
            position: relative;
            width: 50px;
            height: 1344px;
            background-color: #7c7c7c;
            margin-left: -5px;
        }
    </style>
    <script src="js/jquery-1.7.2.min.js"></script>
    <script src="js/paper-full.min.js"></script>
    <script src="js/dataTools.js"></script>
    <script src="js/paper/commonTools.js" type="text/paperscript" canvas="drawCanvas"></script>
    <script src="js/paper/mouseBrush.js" type="text/paperscript" canvas="drawCanvas"></script>
    <script src="js/paper/mainMain.js" type="text/paperscript" canvas="mainCanvas"></script>
    <script src="js/paper/mainConv1.js" type="text/paperscript" canvas="conv1Canvas"></script>
    <script src="js/paper/mainConv2.js" type="text/paperscript" canvas="conv2Canvas"></script>
    <script src="js/paper/mainFc.js" type="text/paperscript" canvas="fullCanvas"></script>
    <script type="text/javascript">
        function postDataAndDraw(img_png_src) {
            dataTool.upload({"image": img_png_src}, function (status) {
                console.log(status);
                dataTool.getInputImage(function (data) {
                    window.inputImage = data;
                    window.mainMainUpdate();
                });
                dataTool.getConv1(function (data) {
                    window.conv1 = data;
                    window.mainConv1Update();
                });
                dataTool.getConv2(function (data) {
                    window.conv2 = data;
                    window.mainConv2Update();
                });
                dataTool.getFc1(function (data) {
                    window.fc1 = data;
                    dataTool.getFc2(function (data) {
                        window.fc2 = data;
                        console.log(window.fc2.h[0]);
                        window.mainFcUpdate();
                    });
                });

                dataTool.getPrediction(function (data) {
                    window.prediction = data.prediction;
                    $("#numberResult").html(data.prediction[0])
                })
            });
        }

        //canvas内容转化为base64格式的dataURL
        function copyImage() {
            const canvas = document.getElementById('drawCanvas');
            const img_png_src = canvas.toDataURL('image/png');
            //document.getElementById('image_png').src = img_png_src;
            postDataAndDraw(img_png_src);
        }

        $(function () {
            $("#conv1Canvas").click(function () {
                $("#line1").hide("slow");
                $("#line2").hide("slow");
                $("#line3").hide("slow");
                $("#conv2Canvas").hide("slow", function () {
                    window.location.href = "/static/Conv1.html";
                });
            });
            
            $("body").mousemove(function (e) {
                // 获得针对浏览器窗口的坐标
                const xx = e.originalEvent.x || e.originalEvent.layerX || 0;
                const yy = e.originalEvent.y || e.originalEvent.layerY || 0;
                const detail = $("#detailCanvas");
                //console.log(xx + '   ' + yy);

                // 获得相对页面的坐标
                if (e.pageY > 150) {
                    detail.show();
                    if (xx < 620) {
                        detail.css({"left": xx + 20, "top": yy - 140});
                    } else {
                        detail.css({"left": xx - 600 - 20, "top": yy - 140});
                    }
                } else {
                    detail.hide();
                }
            });
        });
    </script>
</head>

<body>
<canvas id="detailCanvas"
        style="position: fixed;top: 8px;left: 300px;width: 600px;height: 112px;background-color: #66ccff;z-index: 999;display: none;"></canvas>

<div id="inputDiv" style="width: 1340px;">
    <canvas id="drawCanvas" width="112" height="112" style="background-color: #7c7c7c"></canvas>
    <div style="position: absolute;top: 8px;left: 122px">
        <button id="btnExport" style="width:80px;background-color:pink; " onclick="copyImage(); ">导出</button>
        <br/>
        <button id="btnClear" style="width:80px;background-color:yellow; " onclick="drawClean();">清除</button>
        <div style="top: 8px;left: 212px;">
            识别结果是
            <div id="numberResult"></div>
        </div>
    </div>
</div>

<div id="mainDiv" style="width: 1340px;overflow-x: scroll;z-index: 0;position: relative">
    <canvas id="mainCanvas"></canvas>
    <canvas id="line1" class="line"></canvas>
    <canvas id="conv1Canvas" class="showCanvas" style="width: 272px;"></canvas>
    <canvas id="line2" class="line"></canvas>
    <canvas id="conv2Canvas" class="showCanvas" style="width: 146px;"></canvas>
    <canvas id="line3" class="line"></canvas>
    <canvas id="fullCanvas" class="showCanvas" style="width: 416px;"></canvas>
</div>

</body>

</html>

